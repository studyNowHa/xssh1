wget https://go.dev/dl/go1.19.2.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.19.2.linux-amd64.tar.gz
echo 'export PATH=$PATH:/usr/local/go/bin' >> $HOME/.profile
echo 'export PATH="$PATH:~/go/bin"' >> $HOME/.profile
source $HOME/.profile
go install github.com/caddyserver/xcaddy/cmd/xcaddy@latest
~/go/bin/xcaddy build --with github.com/caddyserver/forwardproxy@caddy2=github.com/klzgrad/forwardproxy@naive
echo ":443, 20221102free.tk #你的域名
tls example@example.com #你的邮箱
route {
 forward_proxy {
   basic_auth user pass #用户名和密码
   hide_ip
   hide_via
   probe_resistance
  }
 #支持多用户
 forward_proxy {
   basic_auth user2 pass2 #用户名和密码
   hide_ip
   hide_via
   probe_resistance
  }
 reverse_proxy  https://demo.cloudreve.org  { #伪装网址
   header_up  Host  {upstream_hostport}
   header_up  X-Forwarded-Host  {host}
  }
}" > Caddyfile

安装 Cloudflared
curl -LO https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
sudo dpkg -i cloudflared-linux-amd64.deb
rm cloudflared-linux-amd64.deb

登录 Cloudflared
hodlpjonjj@iubridge.com
vps2022@
cloudflared tunnel login

证书
-----BEGIN PRIVATE KEY-----
MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgAATk2SfskpDAPuUl
WzkESOloRqW6rArGgYEB2uKMYy6hRANCAATkvNozeodl98Vc8lBY3TrX4BGiHRyV
dRpxi9nNldpQ2a1uJ2G67wk0E7SeKfZ18dk73rUOJTw45R1dLjUVout6
-----END PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
MIIDKzCCAtCgAwIBAgIUKF3ISs9o2o+wrUL58R8SGMz0oKIwCgYIKoZIzj0EAwIw
gY8xCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1T
YW4gRnJhbmNpc2NvMRkwFwYDVQQKExBDbG91ZEZsYXJlLCBJbmMuMTgwNgYDVQQL
Ey9DbG91ZEZsYXJlIE9yaWdpbiBTU0wgRUNDIENlcnRpZmljYXRlIEF1dGhvcml0
eTAeFw0yMjExMDIwODE2MDBaFw0zNzEwMjkwODE2MDBaMGIxGTAXBgNVBAoTEENs
b3VkRmxhcmUsIEluYy4xHTAbBgNVBAsTFENsb3VkRmxhcmUgT3JpZ2luIENBMSYw
JAYDVQQDEx1DbG91ZEZsYXJlIE9yaWdpbiBDZXJ0aWZpY2F0ZTBZMBMGByqGSM49
AgEGCCqGSM49AwEHA0IABOS82jN6h2X3xVzyUFjdOtfgEaIdHJV1GnGL2c2V2lDZ
rW4nYbrvCTQTtJ4p9nXx2TvetQ4lPDjlHV0uNRWi63qjggE0MIIBMDAOBgNVHQ8B
Af8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwIGCCsGAQUFBwMBMAwGA1UdEwEB
/wQCMAAwHQYDVR0OBBYEFGjph48NAnXo4GoajI6a1H7ujUj/MB8GA1UdIwQYMBaA
FIUwXTsqcNTt1ZJnB/3rObQaDjinMEQGCCsGAQUFBwEBBDgwNjA0BggrBgEFBQcw
AYYoaHR0cDovL29jc3AuY2xvdWRmbGFyZS5jb20vb3JpZ2luX2VjY19jYTAtBgNV
HREEJjAkghEqLjIwMjIxMTAyZnJlZS50a4IPMjAyMjExMDJmcmVlLnRrMDwGA1Ud
HwQ1MDMwMaAvoC2GK2h0dHA6Ly9jcmwuY2xvdWRmbGFyZS5jb20vb3JpZ2luX2Vj
Y19jYS5jcmwwCgYIKoZIzj0EAwIDSQAwRgIhAN42wH5PkI9D2ITlOftptqm0P6wl
2c57988sEs0ZezibAiEAguATqi2rTGXbnD2YsTV1WWpgf/sJ6Y11rSBpZGI/TuA=
-----END CERTIFICATE-----
-----BEGIN ARGO TUNNEL TOKEN-----
eyJ6b25lSUQiOiJhN2I3ZmI5Y2YyMTRjOTNlZDVmYWZmYmNkNTBjYzZmZCIsImFj
Y291bnRJRCI6IjE3YTk2ODllNWNjOTEwODVjMTcyYzczMThjYzk5ZDk0Iiwic2Vy
dmljZUtleSI6InYxLjAtM2VlOTkyYTkzMTg3NThhNzA1NjQ1Y2MzLWZkNjU2NjYx
NWJhNmI0ZDA1Mjg5OGE3MDhlNTZiNmU3Y2ZjMWJjZDY5ZDYyOWMxMWRmMmIyYTQw
MzhmZmJlMDY0OGVkOGNhYzEwYjhmMjg3ZDJlMTY3YjRmZTVjM2RiZGZhNzU3NzE2
NmI4MjgyYTUzNWEzNmU2NGJhNzBiMzYxOTcyNmQ0MDkyZTRmNjhkOGQ5NzY0OTM2
Zjg5MDBjNGMiLCJhcGlUb2tlbiI6IkVKbkx1Q1U2UU15R0wxZnN2Mkxxajl6clFk
bnZfRjZrdU5aeDNWd2kifQ==
-----END ARGO TUNNEL TOKEN-----



新建隧道
cloudflared tunnel create vps

新建 Tunnel 对应的 DNS 记录
cloudflared tunnel route dns vps 2022freedns.tk

新建配置文件
echo "tunnel: <Tunnel-UUID>
credentials-file: /root/.cloudflared/<Tunnel-UUID>.json
protocol: h2mux
originRequest:
  connectTimeout: 30s
  noTLSVerify: false
ingress:
  - hostname: <SUBDOMAIN>
    service: http://localhost:80
  - service: http_status:404" > ~/.cloudflared/config.yml
  
启动 Cloudflared
修改systemd文件  
sudo echo "[Unit]
Description=cloudflared
After=network.target

[Service]
TimeoutStartSec=0
Type=notify
ExecStart=/usr/bin/cloudflared --loglevel debug --transport-loglevel warn --config /root/.cloudflared/config.yml tunnel run vps
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target" >> /etc/systemd/system/cloudflared.service

启动 Cloudflared
systemctl enable cloudflared --now

